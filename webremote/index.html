<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>tvPlayer</title>

    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/site.webmanifest">

    <link rel="stylesheet" href="./styles.css?v=250601" />
    <script src="./md5.min.js?v=250601"></script>
    <script src="./mqtt.min.js?v=250601"></script>
    <script src="./scripts.js?v=250601" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
</head> 

<body>
    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <img src="./assets/logo.png?v=250528-B" alt="Logo" style="height: 40px; margin-left:-8px">
            <div class="heartbeatContainer" onclick="showState()">
                <div>
                    <div id="heartbeat"></div>
                </div>
            </div>
        </div>

        <div id="display" class="display" onclick="gebi('playstate').src='assets/icons/timer-sand.svg'; sendCommand({'cmd': 'toggle_play'})">
            <div>
                <img id="playstate" src="./assets/icons/help-rhombus-outline.svg">
            </div>
        </div>
        <div class="playerInfo">
            <div id="currentFile" class="small">No current file. Insert USB with <a href="#" onclick="showValidFiles()">valid video or image files</a>.</div>
            <div style="position: relative; height: 2.5em;">
                <input type="range" id="timeline" value="0" min="0" max="160" step=".1" 
                    oninput="skipperPreviewTime(this)"
                    onchange="skipper(this.value)"
                >
                <div id="timecode">00:00.0/00:00.0</div>
                <div id="inpoint" class="marker in" style="display:none">&nbsp;</div>
                <div id="outpoint" class="marker out" style="display:none">&nbsp;</div>
            </div>
        </div>

        <div class="control-group">
            <!-- MAIN CONTROL -->
            <div class="button-row">
                <button onclick="sendCommand({'cmd': 'prev_channel'})">
                    <img src="assets/icons/skip-previous.svg">
                </button>
                <button onclick="setToWait('playstate'); sendCommand({'cmd': 'toggle_play'}, false, true)" style="width:250%">
                    <img src="assets/icons/play-pause.svg">
                </button>
                <button onclick="sendCommand({'cmd': 'next_channel'})">
                    <img src="assets/icons/skip-next.svg">
                </button>
            </div>

            <!-- SEEKING -->
            <div class="button-row">
                <button onclick="sendCommand({'cmd': 'seek', 'value': -60})">
                    <img src="assets/icons/rewind.svg"><sup class="small">-1m</sup>
                </button>
                <button onclick="sendCommand({'cmd': 'seek', 'value': -5})">
                    <img src="assets/icons/step-backward-2.svg"><sup class="small">-5s</sup>
                </button>
                <button onclick="sendCommand({'cmd': 'seek', 'value': -0.04})">
                    <img src="assets/icons/step-backward.svg"><sup class="small">-f</sup>
                </button>
                <button onclick="sendCommand({'cmd': 'seek', 'value': 0.04})">
                    <img src="assets/icons/step-forward.svg"><sup class="small">+f</sup>
                </button>
                <button onclick="sendCommand({'cmd': 'seek', 'value': 5})">
                    <img src="assets/icons/step-forward-2.svg"><sup class="small">+5s</sup>
                </button>
                <button onclick="sendCommand({'cmd': 'seek', 'value': 60})">
                    <img src="assets/icons/fast-forward.svg"><sup class="small">+1m</sup>
                </button>
            </div>
            <!-- PLAYBACK SPEED -->
            <div class="button-row">
                <div class="buttonNote" id="note-speed" title="speed">1.00&times;</div>
            </div>
            <div class="button-row" style="margin-bottom: 2em;">
                <button onclick="setToWait('note-speed'); sendCommand({'cmd': 'adjust_video_speed', 'value': -0.1}, false, true)">
                    <img src="assets/icons/speedometer-slow.svg"><sup>-</sup>
                </button>
                <button onclick="setToWait('note-speed'); sendCommand({'cmd': 'adjust_video_speed', 'value': 'reset'}, false, true)" style="width:250%">
                    Speed <img src="assets/icons/speedometer-medium.svg"> reset
                </button>
                <button onclick="setToWait('note-speed'); sendCommand({'cmd': 'adjust_video_speed', 'value': 0.1}, false, true)">
                    <img src="assets/icons/speedometer.svg"><sup>+</sup>
                </button>
            </div>

            <span id="filelistLength">0 files</span> on USB:
            <div id="filelist" class="grey">
                No <a href="#" onclick="showValidFiles()">valid files</a> on USB or no USB plugged.

                <!-- <div class="button-row"><button class="filelistButton"><img class="thumbnails" src="./thumbnails/test.jpg">#1: 01<span class="grey">.mp4</span></button></div>
                <div class="button-row"><button class="filelistButton"><img class="thumbnails" src="./thumbnails/test.jpg">#2: asdfasdf_ASDfasdfasdfasdf_ASdfasdfasdf-asDF_ASD_fASD_f_sdfA_sdF<span class="grey">.mp4</span></button></div>
                <div class="button-row"><button class="filelistButton"><img class="thumbnails" src="./thumbnails/test.jpg">#3: asd fasdf sadfasdf asdf asdfasdf asdfasd fasefr awert fasdf sdf asdf sadf asdf<span class="grey">.mp4</span></button></div> -->
            </div>

            
        </div>

        <div class="control-group">
            <h2>A&rarr;B loop</h2>
            <div class="button-row">
                <div class="buttonNote" id="note-inpoint" title="inpoint">-</div>
                <div class="buttonNote" id="note-outpoint" title="outpoint">-</div>
            </div>
            <div class="button-row">
                <button onclick="setToWait('note-inpoint'); sendCommand({'cmd': 'set_inpoint'}, false, true)">Set A <img src="assets/icons/ray-start-arrow.svg"></button>
                <button onclick="setToWait('note-outpoint'); sendCommand({'cmd': 'set_outpoint'}, false, true)"><img src="assets/icons/ray-end-arrow.svg"> Set B</button>
            </div>
            <div class="button-row">
                <button onclick="setToWait('note-inpoint'); sendCommand({'cmd': 'clear_inpoint'}, false, true)">Clear A <img src="assets/icons/ray-start-arrow-close.svg"></button>
                <button onclick="setToWait('note-outpoint'); sendCommand({'cmd': 'clear_outpoint'}, false, true)"><img src="assets/icons/ray-end-arrow-close.svg"> Clear B</button>
            </div>
        </div>

        <div class="control-group">
            <h2>Fill colors</h2>
            <div class="button-row">
                <div class="buttonNote" id="note-toggle_black_screen" title="Black screen" style="opacity:0;">
                    -
                </div>
                <div class="buttonNote" id="note-cycle_white_noise" title="Current White Noise Style">
                    <img src="assets/screens/noise0.png">
                </div>
            </div>
            <div class="button-row">
                <button onclick="setToWait('note-toggle_black_screen'); sendCommand({'cmd': 'toggle_black_screen'}, false, true)">Show/Hide Black Screen</button>
                <button onclick="setToWait('note-cycle_white_noise'); sendCommand({'cmd': 'cycle_white_noise'}, false, true)">Set Noise Style</button>
            </div>
            <div class="button-row">
                <div class="buttonNote" id="note-cycle_green_screen" title="Current Green Screen Style">
                    <img src="assets/screens/green0.png">
                </div>
            </div>
            <div class="button-row">
                <button onclick="setToWait('note-cycle_green_screen'); sendCommand({'cmd': 'cycle_green_screen', 'value': -1}, false, true)">Green Style -</button>
                <button onclick="setToWait('note-cycle_green_screen'); sendCommand({'cmd': 'cycle_green_screen', 'value': 0}, false, true)" style="width:250%">Show/Hide Green Screen</button>
                <button onclick="setToWait('note-cycle_green_screen'); sendCommand({'cmd': 'cycle_green_screen', 'value': 1}, false, true)">Green Style +</button>
            </div>
        </div>

        <div class="control-group">
            <h2>Image adjustment</h2>
            <div class="button-row">
                <div class="buttonNote" id="note-videoFitting" title="This video fitting">
                    -
                </div>
            </div>
            <div class="button-row">
                <button onclick="setToWait('note-videoFitting'); sendCommand({'cmd': 'set_video_fitting'}, false, true)">
                    Cycle Video Fittings
                    <img src="assets/icons/view-array-outline.svg">
                </button>
            </div>
            <div class="button-row">
                <div class="buttonNote" id="note-brightness" title="brightness">50</div>
                <div class="buttonNote" id="note-contrast" title="contrast">50</div>
                <div class="buttonNote" id="note-saturation" title="saturation">50</div>
            </div>
            <div class="button-row">
                <button onclick="setToWait('note-brightness'); sendCommand({'cmd': 'adjust_video_brightness', 'value': -5}, false, true)">
                    <img src="assets/icons/brightness-6.svg"><sup>-</sup>
                </button>
                <button onclick="setToWait('note-brightness'); sendCommand({'cmd': 'adjust_video_brightness', 'value': 5}, false, true)">
                    <img src="assets/icons/brightness-6.svg"><sup>+</sup>
                </button>
                <button onclick="setToWait('note-contrast'); sendCommand({'cmd': 'adjust_video_contrast', 'value': -5}, false, true)">
                    <img src="assets/icons/image-filter-black-white.svg"><sup>-</sup>
                </button>
                <button onclick="setToWait('note-contrast'); sendCommand({'cmd': 'adjust_video_contrast', 'value': 5}, false, true)">
                    <img src="assets/icons/image-filter-black-white.svg"><sup>+</sup>
                </button>
                <button onclick="setToWait('note-saturation'); sendCommand({'cmd': 'adjust_video_saturation', 'value': -5}, false, true)">
                    <img src="assets/icons/palette.svg"><sup>-</sup>
                </button>
                <button onclick="setToWait('note-saturation'); sendCommand({'cmd': 'adjust_video_saturation', 'value': 5}, false, true)">
                    <img src="assets/icons/palette.svg"><sup>+</sup>
                </button>
            </div>
            <div class="button-row">
                <div class="buttonNote" id="note-zoom" title="zoom">100</div>
            </div>
            <div class="button-row">
                <button onclick="setToWait('note-zoom'); sendCommand({'cmd': 'zoom', 'value': -0.01}, false, true)">
                    <img src="assets/icons/magnify-minus.svg">
                </button>
                <button onclick="setToWait('note-zoom'); sendCommand({'cmd': 'zoom', 'value': 0}, false, true)" style="width:250%">
                    <img src="assets/icons/magnify.svg">
                </button>
                <button onclick="setToWait('note-zoom'); sendCommand({'cmd': 'zoom', 'value': 0.01}, false, true)">
                    <img src="assets/icons/magnify-plus.svg">
                </button>
            </div>
            <div class="button-row">
                <div class="buttonNote" id="note-pan" title="pan">X 0.0 / Y 0.0</div>
            </div>
            <div class="button-row">
                <button 
                    onmousedown="startPan(event, 'x', -1)"
                    onmouseup="stopPan(event, 'x', -1)"
                    onmouseleave="stopPan(event, 'x', -1)"
                    ontouchstart="startPan(event, 'x', -1)"
                    ontouchend="stopPan(event, 'x', -1)"
                >Move Left</button>
                <button onclick="setToWait('note-pan'); sendCommand({'cmd': 'pan', 'value': ['reset', 'x']}, false, true)">
                    Reset <img src="assets/icons/arrow-left-right.svg">
                </button>
                <button 
                    onmousedown="startPan(event, 'x', 1)"
                    onmouseup="stopPan(event, 'x', 1)"
                    onmouseleave="stopPan(event, 'x', 1)"
                    ontouchstart="startPan(event, 'x', 1)"
                    ontouchend="stopPan(event, 'x', 1)"
                >Move Right</button>
            </div>
            <div class="button-row">
                <button onclick="setToWait('note-pan'); sendCommand({'cmd': 'pan_reset'}, false, true)">
                    Reset <img src="assets/icons/arrow-all.svg">
                </button>
            </div>
            <div class="button-row">
                <button 
                    onmousedown="startPan(event, 'y', -1)"
                    onmouseup="stopPan(event, 'y', -1)"
                    onmouseleave="stopPan(event, 'y', -1)"
                    ontouchstart="startPan(event, 'y', -1)"
                    ontouchend="stopPan(event, 'y', -1)"
                >Move Up</button>
                <button onclick="setToWait('note-pan'); sendCommand({'cmd': 'pan', 'value': ['reset', 'y']}, false, true)">
                    Reset <img src="assets/icons/arrow-up-down.svg">
                </button>
                <button 
                    onmousedown="startPan(event, 'y', 1)"
                    onmouseup="stopPan(event, 'y', 1)"
                    onmouseleave="stopPan(event, 'y', 1)"
                    ontouchstart="startPan(event, 'y', 1)"
                    ontouchend="stopPan(event, 'y', 1)"
                >Move Down</button>
            </div>
        </div>

        <div class="control-group">
            <h2>Look & feel</h2>
            <div class="button-row">
                <div class="buttonNote" id="note-show_tv_gui" title="TV GUI">-</div>
                <div class="buttonNote" id="note-white_noise_on_channel_change" title="White Noise">-</div>
            </div>
            <div class="button-row">
                <button onclick="setToWait('note-show_tv_gui'); sendCommand({'cmd': 'toggle_show_tv_gui'}, false, true)">
                    Show/Hide TV channel numbers
                    <img src="assets/icons/tv-gui.svg">
                </button>
                <button onclick="setToWait('note-white_noise_on_channel_change'); sendCommand({'cmd': 'toggle_white_noise_on_channel_change'}, false, true)">
                    Show/Hide white noise between channel changes
                    <img src="assets/icons/gradient-vertical.svg">
                </button>
            </div>
            <div class="button-row">
                <div class="buttonNote" id="note-volume" title="volume">100</div>
            </div>
            <div class="button-row">
                <button onclick="setToWait('note-volume'); sendCommand({'cmd': 'adjust_volume', 'value': -10}, false, true)">
                    <img src="assets/icons/volume-minus.svg">
                </button>
                <button onclick="setToWait('note-volume'); sendCommand({'cmd': 'adjust_volume', 'value': 10}, false, true)">
                    <img src="assets/icons/volume-plus.svg">
                </button>
            </div>
        </div>

        <div class="control-group">
            <h2>System</h2>
            <div class="button-row">
                <button onclick="sendCommand({'cmd': 'shutdown'}); window.location.href = 'shutdown.html'">
                    Shutdown
                    <img src="assets/icons/power.svg">
                </button>
                <button onclick="sendCommand({'cmd': 'reboot'}); window.location.href = 'reboot.html'">
                    Reboot
                    <img src="assets/icons/restart.svg">
                </button>
            </div>
        </div>

        <div class="control-group small grey" style="text-align: center;">
            tvPlayer by Fabian Lüscher with <img src="assets/icons/heart-box.svg" style="height:1.5em; opacity: .7; vertical-align: middle;"> @ 2025
            <div class="small">www.fluescher.ch</div>
        </div>

        <div class="control-group">
            <button style="position: relative; width: 100%; margin-bottom: 1em;">
                <div id="adminPanel-toggle-on" onclick="show('adminPanel', 'adminPanel-toggle-off'); hide('adminPanel-toggle-on')">
                    Show Admin Panel
                </div>
                <div id="adminPanel-toggle-off" onclick="show('adminPanel-toggle-on'); hide('adminPanel', 'adminPanel-toggle-off')" style="display: none;">
                    Hide Admin Panel
                </div>
            </button>
            <div id="adminPanel" style="display: none;">
                <div class="button-row">
                    <button onclick="sendCommand({'cmd': 'toggle_fullscreen'})">Toggle Fullscreen</button>
                    <button onclick="sendCommand({'cmd': 'restart'})">Restart App</button>
                    <button onclick="sendCommand({'cmd': 'close_program'})">Exit to Desktop</button>
                    <a href="http://10.3.141.1" target="_blank"><button>RaspAP&nbsp;Admin</button></a>
                </div>
                <h2 style="margin-top:2em;">
                    MQTT Console
                </h2>
                <button onclick="sendConsole()">
                    Send MQTT console to Fabian Lüscher by mail
                </button>
                <div id="console" class="maxHeight400" style="margin-top: 1em; padding: 1em; background-color: black; border-radius: 4px;  font-family: 'Courier New', Courier, monospace; font-size: .8em; line-height: 1.5em;">Init</div>
            </div>
        </div>
    </div>
</body>

</html>